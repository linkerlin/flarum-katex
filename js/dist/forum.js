(()=>{var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["common/extend"],r=flarum.core.compat["common/app"];var a=e.n(r);const o=flarum.core.compat["common/components/Page"];var n=e.n(o);const c=flarum.core.compat["common/components/TextEditor"];var i=e.n(c);const l=flarum.core.compat["forum/components/ComposerBody"];var u=e.n(l);a().initializers.add("linkerlin-katex",function(){var e=a().forum.attribute("katex.cdn_katex_css");if(e&&!document.querySelector('link[href="'+e+'"]')){var r=document.createElement("link");r.rel="stylesheet",r.href=e,document.head.appendChild(r)}if(a().forum.attribute("katex.enable_copy_tex")){var o=a().forum.attribute("katex.cdn_copy_tex");if(o&&!document.querySelector('script[src="'+o+'"]')){var c=document.createElement("script");c.src=o,c.defer=!0,c.crossOrigin="anonymous",document.head.appendChild(c)}}var l=function(e){var t=a().forum.attribute("katex.inline_delimiters"),r=a().forum.attribute("katex.block_delimiters"),o=a().forum.attribute("katex.bbcode_inline_delimiters"),n=a().forum.attribute("katex.bbcode_block_delimiters");if(!e)return e;if(t&&o){var c=t.replace("%e%","([\\s\\S]*?)").replace(/\\\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\$/g,"\\$"),i=new RegExp(c,"g"),l=o.replace("%e%","$1");e=e.replace(i,l)}if(r&&n){var u=r.replace("%e%","([\\s\\S]*?)").replace(/\$/g,"\\$"),d=new RegExp(u,"g"),p=n.replace("%e%","$1");e=e.replace(d,p)}return e};(0,t.extend)(i().prototype,"oncreate",function(e){var t=e.dom.querySelector("textarea");t&&t.value&&(t.value=function(e){var t=a().forum.attribute("katex.inline_delimiters"),r=a().forum.attribute("katex.block_delimiters"),o=a().forum.attribute("katex.bbcode_inline_delimiters"),n=a().forum.attribute("katex.bbcode_block_delimiters");if(!e)return e;if(o&&t){var c=o.replace("%e%","([\\s\\S]*?)").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),i=new RegExp(c,"g"),l=t.replace("%e%","$1");e=e.replace(i,l)}if(n&&r){var u=n.replace("%e%","([\\s\\S]*?)").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),d=new RegExp(u,"g"),p=r.replace("%e%","$1");e=e.replace(d,p)}return e}(t.value))}),(0,t.extend)(u().prototype,"onsubmit",function(){var e=this.composer.fields.content();e&&this.composer.fields.content(l(e))}),"undefined"!=typeof s9e&&s9e.TextFormatter&&(0,t.override)(s9e.TextFormatter,"preview",function(e,t,r){e(l(t),r)});var d=function(){"undefined"!=typeof katex&&(document.querySelectorAll(".katex-inline").forEach(function(e){if(!e.hasAttribute("data-katex-rendered"))try{var t=JSON.parse(e.getAttribute("data-katex-options")||"{}");katex.render(e.textContent,e,t),e.setAttribute("data-katex-rendered","true")}catch(e){console.error("KaTeX inline rendering error:",e)}}),document.querySelectorAll(".katex-block").forEach(function(e){if(!e.hasAttribute("data-katex-rendered"))try{var t=JSON.parse(e.getAttribute("data-katex-options")||"{}");katex.render(e.textContent,e,t),e.setAttribute("data-katex-rendered","true")}catch(e){console.error("KaTeX block rendering error:",e)}}))};(0,t.extend)(n().prototype,["oncreate","onupdate"],d);var p=a().forum.attribute("katex.cdn_katex_js");if(p&&"undefined"==typeof katex){var m=document.createElement("script");m.src=p,m.defer=!0,m.crossOrigin="anonymous",m.onload=d,document.head.appendChild(m)}else"undefined"!=typeof katex&&d()})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map